{% extends "base.html" %}

{% block title %}Add Missing Person - AI Missing Person Detection System{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="text-center mb-4">
            <h2 class="display-5 fw-bold text-primary">
                <i class="fas fa-user-plus me-3"></i>
                Add Missing Person
            </h2>
            <p class="lead text-muted">
                Upload photo and details to add a missing person to the detection database
            </p>
        </div>

        <div class="card">
            <div class="card-body p-4">
                <form method="POST" enctype="multipart/form-data" id="addPersonForm">
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-user me-2"></i>
                                Personal Information
                            </h5>
                            
                            <div class="mb-3">
                                <label for="name" class="form-label">
                                    <i class="fas fa-user me-1"></i>
                                    Full Name *
                                </label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>

                            <div class="mb-3">
                                <label for="age" class="form-label">
                                    <i class="fas fa-birthday-cake me-1"></i>
                                    Age *
                                </label>
                                <input type="number" class="form-control" id="age" name="age" min="1" max="120" required>
                            </div>

                            <div class="mb-3">
                                <label for="contact_email" class="form-label">
                                    <i class="fas fa-envelope me-1"></i>
                                    Contact Email
                                </label>
                                <input type="email" class="form-control" id="contact_email" name="contact_email">
                                <div class="form-text">For notifications when person is detected</div>
                            </div>
                        </div>

                        <!-- Missing Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Missing Information
                            </h5>
                            
                            <div class="mb-3">
                                <label for="last_seen_location" class="form-label">
                                    <i class="fas fa-map-pin me-1"></i>
                                    Last Seen Location *
                                </label>
                                <input type="text" class="form-control" id="last_seen_location" name="last_seen_location" required>
                            </div>

                            <div class="mb-3">
                                <label for="date_missing" class="form-label">
                                    <i class="fas fa-calendar me-1"></i>
                                    Date Missing *
                                </label>
                                <input type="date" class="form-control" id="date_missing" name="date_missing" required>
                            </div>

                            <div class="mb-3">
                                <label for="additional_info" class="form-label">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Additional Information
                                </label>
                                <textarea class="form-control" id="additional_info" name="additional_info" rows="3" 
                                          placeholder="Any additional details about the missing person..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Photo Upload -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-camera me-2"></i>
                                Photo Upload
                            </h5>
                            
                            <div class="mb-3">
                                <label for="photo" class="form-label">
                                    <i class="fas fa-image me-1"></i>
                                    Person's Photo *
                                </label>
                                <input type="file" class="form-control" id="photo" name="photo" 
                                       accept="image/*" required>
                                <div class="form-text">
                                    Upload a clear, front-facing photo of the missing person. 
                                    Supported formats: JPG, PNG, GIF
                                </div>
                            </div>

                            <!-- Photo Preview -->
                            <div class="mb-3" id="photoPreview" style="display: none;">
                                <label class="form-label">Photo Preview:</label>
                                <div class="text-center">
                                    <img id="previewImage" class="img-fluid rounded" style="max-height: 300px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="row mt-4">
                        <div class="col-12 text-center">
                            <button type="submit" class="btn btn-primary btn-lg me-3">
                                <i class="fas fa-save me-2"></i>
                                Add to Database
                            </button>
                            <a href="{{ url_for('home') }}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left me-2"></i>
                                Back to Home
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title text-primary">
                    <i class="fas fa-lightbulb me-2"></i>
                    Important Notes
                </h5>
                <ul class="mb-0">
                    <li><strong>Photo Quality:</strong> Use clear, well-lit photos for better detection accuracy.</li>
                    <li><strong>Face Visibility:</strong> Ensure the person's face is clearly visible and unobstructed.</li>
                    <li><strong>Recent Photos:</strong> Use recent photos that accurately represent the person's current appearance.</li>
                    <li><strong>Multiple Photos:</strong> You can add multiple photos of the same person for better recognition.</li>
                    <li><strong>Privacy:</strong> All information is stored locally and securely.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Photo preview functionality
document.getElementById('photo').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('photoPreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        document.getElementById('photoPreview').style.display = 'none';
    }
});

// Form validation
document.getElementById('addPersonForm').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const age = document.getElementById('age').value;
    const location = document.getElementById('last_seen_location').value.trim();
    const date = document.getElementById('date_missing').value;
    const photo = document.getElementById('photo').files[0];

    if (!name || !age || !location || !date || !photo) {
        e.preventDefault();
        alert('Please fill in all required fields and upload a photo.');
        return false;
    }

    if (age < 1 || age > 120) {
        e.preventDefault();
        alert('Please enter a valid age between 1 and 120.');
        return false;
    }

    // Show loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Adding...';
    submitBtn.disabled = true;
});
</script>
{% endblock %} 